<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voucher Code Predictor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Share Tech Mono', monospace;
            background-color: #0a0a1a;
            color: #e0e0ff;
        }
        .font-orbitron {
            font-family: 'Orbitron', sans-serif;
        }
        .glass-card {
            background: rgba(20, 20, 40, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 1rem;
        }
        .glowing-text {
            text-shadow: 0 0 8px rgba(100, 200, 255, 0.8), 0 0 20px rgba(100, 200, 255, 0.6);
        }
        .input-field {
            background-color: rgba(0,0,0,0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }
        .input-field:focus {
            outline: none;
            border-color: #88aaff;
            box-shadow: 0 0 15px rgba(100, 150, 255, 0.5);
        }
        .btn-predict {
            background: linear-gradient(45deg, #3a7bd5, #3a60d5);
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(58, 123, 213, 0.4);
        }
        .btn-predict:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(58, 123, 213, 0.6);
        }
        .loader {
            border: 4px solid rgba(255, 255, 255, 0.2);
            border-left-color: #88aaff;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4 bg-dots">
    <div class="w-full max-w-2xl mx-auto space-y-8">
        <!-- Header Section -->
        <div class="text-center">
            <h1 class="text-4xl md:text-5xl font-orbitron font-bold glowing-text">Voucher Code Predictor</h1>
            <p class="text-indigo-300 mt-2">Analyzing sequences with advanced mathematical relations.</p>
        </div>

        <!-- Input Card -->
        <div class="glass-card p-6 md:p-8">
            <div class="space-y-4">
                <label for="codes-input" class="block text-lg font-medium text-indigo-200">Enter Known Voucher Codes</label>
                <textarea id="codes-input" rows="4" class="w-full p-3 rounded-lg input-field text-lg" placeholder="e.g., 10, 20"></textarea>
                <p class="text-sm text-gray-400">Enter numbers separated by commas, spaces, or new lines. At least 2 are needed.</p>
                <button id="predict-btn" class="w-full py-3 text-lg font-bold text-white rounded-lg btn-predict font-orbitron">
                    Analyze & Predict
                </button>
            </div>
        </div>

        <!-- Results Section -->
        <div id="results-container" class="hidden">
            <div class="flex justify-center mb-4">
                <div id="loader" class="loader hidden"></div>
            </div>
            <div id="result-card" class="glass-card p-6 md:p-8 text-center hidden">
                <h2 class="text-xl font-orbitron text-indigo-300 mb-2">Prediction Result</h2>
                <p class="text-5xl md:text-6xl font-bold glowing-text" id="predicted-code"></p>
                <div class="mt-6 pt-6 border-t border-gray-700">
                    <h3 class="text-lg font-orbitron text-indigo-300 mb-2">Detected Mathematical Relation</h3>
                    <p class="text-lg text-green-300" id="pattern-explanation"></p>
                </div>
            </div>
            <div id="error-card" class="glass-card p-6 text-center hidden">
                 <h2 class="text-xl font-orbitron text-red-400 mb-2">Analysis Failed</h2>
                 <p class="text-lg text-red-300" id="error-message"></p>
            </div>
        </div>
    </div>

    <script>
        // --- DOM Element References ---
        const predictBtn = document.getElementById('predict-btn');
        const codesInput = document.getElementById('codes-input');
        const resultsContainer = document.getElementById('results-container');
        const loader = document.getElementById('loader');
        const resultCard = document.getElementById('result-card');
        const errorCard = document.getElementById('error-card');
        const predictedCodeEl = document.getElementById('predicted-code');
        const patternExplanationEl = document.getElementById('pattern-explanation');
        const errorMessageEl = document.getElementById('error-message');

        // --- Event Listener ---
        predictBtn.addEventListener('click', handlePrediction);

        /**
         * Main handler function when the prediction button is clicked.
         */
        function handlePrediction() {
            // 1. Get and parse input
            const rawInput = codesInput.value;
            if (!rawInput.trim()) {
                showError("Input cannot be empty. Please enter a sequence of numbers.");
                return;
            }

            // --- MODIFIED: Split by commas, spaces, or newlines ---
            const numbers = rawInput.split(/[\s,]+/)
                .map(s => s.trim())
                .filter(s => s !== '')
                .map(s => parseFloat(s));
            
            if (numbers.some(isNaN)) {
                showError("Invalid input. Please ensure all values are numbers.");
                return;
            }

            if (numbers.length < 2) {
                showError("Insufficient data. Please provide at least 2 numbers to detect a pattern.");
                return;
            }

            // 2. Show loading state and hide previous results
            showLoading();

            // 3. Run prediction logic after a short delay to show the loader
            setTimeout(() => {
                const result = findPatternAndPredict(numbers);
                hideLoading();

                if (result) {
                    showSuccess(result.prediction, result.explanation);
                } else {
                    showError("Could not determine a mathematical pattern from the provided sequence.");
                }
            }, 500);
        }

        /**
         * Tries to find a pattern in the sequence and returns a prediction.
         * @param {number[]} arr - The array of numbers.
         * @returns {object|null} An object with prediction and explanation, or null if no pattern is found.
         */
        function findPatternAndPredict(arr) {
            let result;

            // Try Arithmetic Progression first as it's most common
            result = checkArithmetic(arr);
            if (result) return result;

            // Try Geometric Progression
            result = checkGeometric(arr);
            if (result) return result;
            
            // Try Quadratic Progression (will only run if there are 3+ numbers)
            result = checkQuadratic(arr);
            if (result) return result;

            return null; // No pattern found
        }

        // --- Pattern Detection Functions ---

        /**
         * Checks for an arithmetic progression (e.g., 2, 4, 6, 8).
         * @param {number[]} arr - The array of numbers.
         * @returns {object|null} The prediction result or null.
         */
        function checkArithmetic(arr) {
            const diff = arr[1] - arr[0];
            for (let i = 2; i < arr.length; i++) {
                if (arr[i] - arr[i - 1] !== diff) {
                    return null;
                }
            }
            const prediction = arr[arr.length - 1] + diff;
            const explanation = `Arithmetic Progression. Each number increases by a constant difference of ${diff}.`;
            return { prediction, explanation };
        }

        /**
         * Checks for a geometric progression (e.g., 2, 4, 8, 16).
         * @param {number[]} arr - The array of numbers.
         * @returns {object|null} The prediction result or null.
         */
        function checkGeometric(arr) {
            if (arr.includes(0)) return null; // Avoid division by zero
            const ratio = arr[1] / arr[0];
            for (let i = 2; i < arr.length; i++) {
                // Use a tolerance for floating point comparisons
                if (Math.abs(arr[i] / arr[i - 1] - ratio) > 1e-9) {
                    return null;
                }
            }
            const prediction = arr[arr.length - 1] * ratio;
            const explanation = `Geometric Progression. Each number is multiplied by a constant ratio of ${ratio.toFixed(4)}.`;
            return { prediction, explanation };
        }

        /**
         * Checks for a quadratic progression (f(n) = an^2 + bn + c).
         * This requires at least 3 points to solve for the coefficients a, b, and c.
         * @param {number[]} arr - The array of numbers.
         * @returns {object|null} The prediction result or null.
         */
        function checkQuadratic(arr) {
            if (arr.length < 3) return null;

            const y0 = arr[0];
            const y1 = arr[1];
            const y2 = arr[2];
            
            const c = y0;
            const a = (y2 - 2 * y1 + y0) / 2;
            const b = y1 - y0 - a;
            
            const formula = (n) => a * n * n + b * n + c;

            for (let i = 3; i < arr.length; i++) {
                if (Math.abs(formula(i) - arr[i]) > 1e-9) {
                    return null;
                }
            }
            
            const prediction = formula(arr.length);
            const explanation = `Quadratic Progression. The sequence follows the formula f(n) = ${a.toFixed(2)}n² + ${b.toFixed(2)}n + ${c.toFixed(2)}, where n starts at 0.`;
            return { prediction, explanation };
        }

        // --- UI Update Functions ---

        function showLoading() {
            resultsContainer.classList.remove('hidden');
            loader.classList.remove('hidden');
            resultCard.classList.add('hidden');
            errorCard.classList.add('hidden');
        }

        function hideLoading() {
            loader.classList.add('hidden');
        }

        function showSuccess(prediction, explanation) {
            resultCard.classList.remove('hidden');
            errorCard.classList.add('hidden');
            predictedCodeEl.textContent = prediction.toLocaleString();
            patternExplanationEl.textContent = explanation;
        }

        function showError(message) {
            resultsContainer.classList.remove('hidden');
            errorCard.classList.remove('hidden');
            resultCard.classList.add('hidden');
            errorMessageEl.textContent = message;
        }

    </script>
</body>
</html>
